(window.__se_editor_jsonp=window.__se_editor_jsonp||[]).push([[64],{1336:function(e,t,o){"use strict";o.r(t);var s,i=o(12),n=o.n(i),r=o(18),a=o.n(r),u=o(0),c=o.n(u),d=o(50),l=o.n(d),p=o(71),h=o(52),_=o(54),f=o.n(_),m=o(49),y=o(376),C=o(51),g=o(86),v=o(87),T=o(88),E=o(76),b=o(468),P=o(493),x=o(1276),w=o.n(x),O=o(250),R=o.n(O),j=(s=function(e){function t(t){var o;return(o=e.call(this,t)||this)._componentFactory=C.W.get("componentFactory"),o._elementRef=m.b.createRef(),o._clipboard=new C.p,o._focusTimeoutId=0,o._cursorPosTimeoutId=0,o.state={isEditing:!1},o._initPrism(),o}c()(t,e);var o=t.prototype;return o.UNSAFE_componentWillMount=function(){var e=this;this._disposeReaction=m.f.reaction(function(){return{focused:e.state.isEditing}},function(t){t.focused?e._elementRef.current.classList.add("se-is-focused"):e._elementRef.current.classList.remove("se-is-focused")})},o.componentDidMount=function(){this._initAutoSize();var e=this.props,t=e.store,o=e.shouldForceRefresh,s=t.codeContents;o&&this.props.useCase.refreshAfterLazy(),""===s&&this._switchToEditMode()},o.componentDidUpdate=function(){this.state.isEditing&&(R.a.update(this._elCodeTextEditor),this._setFocus())},o.componentWillUnmount=function(){this._clearTimeoutFocus(),this._clearTimeoutCursorPos(),this._disposeReaction()},o.render=function(){var e=this.props,t=e.store,o=e.i18n,s=t.id,i=t.ctype,n=t.layout,r=t.codeTextMaxLength,a=this._resolveCodeClassName(),u=this._resolveCodeHighlightedClassName(),c=this._resolveCodeEditorClassName();return m.b.createElement(g.a,{id:s,ctype:i,layout:n,i18n:o},m.b.createElement(v.a,{compId:s,compStore:t},m.b.createElement(T.a,{blockWrapperProps:t},m.b.createElement(E.a,{forwardRef:this._elementRef,ctype:i,className:a},m.b.createElement("div",{className:u,draggable:"true"},m.b.createElement("pre",{className:"language-javascript",onMouseDown:this._handleMouseDownCodeContent},m.b.createElement("code",{className:"language-javascript",dangerouslySetInnerHTML:{__html:this._makeCodeHTML()}}))),m.b.createElement("div",{className:"se-code-source se-code-source-edit-mode"},m.b.createElement("textarea",{className:c,ref:this._ref,onBlur:this._handleBlurCodeEditor,onPaste:this._handlePasteCodeEditor,onKeyDown:this._handleKeydown,onKeyUp:this._handleKeyUp,rows:"1",maxLength:r,placeholder:o("codeComponent:placeholder")}))))))},o._makeCodeHTML=function(){var e=this.props,t=e.store,o=e.i18n,s=t.codeContents,i=o("codeComponent:placeholder");return""===s?'<span class="se-placeholder">'+i+"</span>":this._resolveHighlightedCode(s)},o._initPrism=function(){var e={};Object(p.a)(w.a.languages.javascript,function(t,o){o.indexOf("se-code-")>-1||(e["se-code-"+o]=w.a.languages.javascript[o],delete w.a.languages.javascript[o])}),w.a.languages.javascript=w.a.languages.extend("javascript",e)},o._initAutoSize=function(){R()(this._elCodeTextEditor),this._elCodeTextEditor.style.wordWrap="normal"},o._resolveHighlightedCode=function(e){return w.a.highlight(e,w.a.languages.javascript)},o._resolveCodeClassName=function(){var e,t=this.props.store.fontSizeCode,o=this.state.isEditing;return f()(((e={"se-is-focused":o})["se-"+t]=!0,e))},o._resolveCodeHighlightedClassName=function(){return f()({"se-code-source":!0,"se-code-source-highlighted":!0})},o._resolveCodeEditorClassName=function(){return f()({"se-code-source-editor":!0})},o._updateTextEditorValue=function(){var e=this.props.store.codeContents;this._elCodeTextEditor.value=e},o._isModifierKeyPressed=function(e){return e.ctrlKey||e.metaKey||e.shiftKey||e.altKey},o._isNonPrintableKey=function(e){return 1!==e.key.length&&"Enter"!==e.key&&"Spacebar"!==e.key},o._handleMouseDownCodeContent=function(e){this._isModifierKeyPressed(e)||(e.stopPropagation(),this._switchToEditMode(),this._updateTextEditorValue())},o._handleBlurCodeEditor=function(){this._updateCodeContents(),this._stopEditing()},o._handlePasteCodeEditor=function(){var e=a()(n.a.mark(function e(t){var o,s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._clipboard.get(t);case 2:if(o=e.sent,""!==(s=this._getPureValueFrom(o))){e.next=6;break}return e.abrupt("return");case 6:this._paste(s);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),o._handleKeyUp=function(e){this._handleOverLimitText(e)},o._handleKeydown=function(e){"Tab"===e.key&&e.preventDefault()},o._handleOverLimitText=function(e){if(!this._isNonPrintableKey(e)){var t=this.props.store.codeTextMaxLength,o=e.target;o.value.length>=t&&(this.props.useCase.showToastForOverflowMaxLength(),o.value=o.value.substr(0,t))}},o._paste=function(e){var t=this._elCodeTextEditor,o=t.selectionStart,s=t.selectionEnd,i=t.value.substring(0,o)+e+t.value.substring(s);t.value=i;var n=o+e.length;this._setCursorPos(n,n)},o._getPureValueFrom=function(e){var t=this._componentFactory.createComponentByCtype("text"),o=["text","sectionTitle"];return e.forEach(function(e){o.includes(e.ctype)&&t.insert(e)}),t.removeFirstParagraph(),t.getPlainText()},o._activateUnit=function(){var e=this.props.store;"single"!==e.selection&&this.props.useCase.activateUnit(e.id)},o._setCursorPos=function(e,t){var o=this._elCodeTextEditor;if("selectionStart"in o)this._setTimeoutCursorPos(o,e,t);else if(o.createTextRange){var s=o.createTextRange();s.moveStart("character",e),s.collapse(),s.moveEnd("character",t-e),s.select()}},o._setTimeoutCursorPos=function(e,t,o){this._clearTimeoutCursorPos(),this._cursorPosTimeoutId=setTimeout(function(){e.selectionStart=t,e.selectionEnd=o},1)},o._clearTimeoutCursorPos=function(){this._cursorPosTimeoutId&&clearTimeout(this._cursorPosTimeoutId)},o._updateCodeContents=function(){var e=this.props.store,t=this._elCodeTextEditor.value;this.props.useCase.updateCodeContents(e.id,t)},o._switchToEditMode=function(){this._activateUnit(),this._setTimeoutFocus()},o._setTimeoutFocus=function(){var e=this;this._clearTimeoutFocus(),this._focusTimeoutId=setTimeout(function(){e._startEditing(),e._setFocus()},10)},o._clearTimeoutFocus=function(){this._focusTimeoutId&&clearTimeout(this._focusTimeoutId)},o._setFocus=function(){this._elCodeTextEditor&&this._elCodeTextEditor.focus(),this.props.useCase.blurVirtualEditable()},o._startEditing=function(){this.setState({isEditing:!0})},o._stopEditing=function(){this.setState({isEditing:!1})},o._ref=function(e){this._elCodeTextEditor=e},t}(m.b.Component),l()(s.prototype,"_handleMouseDownCodeContent",[h.autobind,h.muteIfReadOnly],Object.getOwnPropertyDescriptor(s.prototype,"_handleMouseDownCodeContent"),s.prototype),l()(s.prototype,"_handleBlurCodeEditor",[h.autobind,h.muteIfReadOnly],Object.getOwnPropertyDescriptor(s.prototype,"_handleBlurCodeEditor"),s.prototype),l()(s.prototype,"_handlePasteCodeEditor",[h.autobind,h.muteIfReadOnly],Object.getOwnPropertyDescriptor(s.prototype,"_handlePasteCodeEditor"),s.prototype),l()(s.prototype,"_handleKeyUp",[h.autobind,h.muteIfReadOnly],Object.getOwnPropertyDescriptor(s.prototype,"_handleKeyUp"),s.prototype),l()(s.prototype,"_handleKeydown",[h.autobind,h.muteIfReadOnly],Object.getOwnPropertyDescriptor(s.prototype,"_handleKeydown"),s.prototype),l()(s.prototype,"_handleOverLimitText",[h.autobind,h.muteIfReadOnly],Object.getOwnPropertyDescriptor(s.prototype,"_handleOverLimitText"),s.prototype),l()(s.prototype,"_ref",[h.autobind],Object.getOwnPropertyDescriptor(s.prototype,"_ref"),s.prototype),s);j.defaultProps={i18n:function(e){return e}},j.propTypes={shouldForceRefresh:m.a.bool,store:m.a.instanceOf(P.a).isRequired,useCase:m.a.instanceOf(b.a).isRequired,i18n:m.a.func},t.default=Object(y.b)(j)}}]);